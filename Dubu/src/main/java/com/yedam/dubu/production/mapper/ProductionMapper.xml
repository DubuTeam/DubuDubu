<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.dubu.production.mapper.ProductionMapper">

	<!-- 조회 -->
	<select id="selectPrcList" resultType="ProductionVO">
		SELECT DISTINCT(PRCS_DIV) FROM PRCS 
	</select>
	<!-- 그리드 -->
	<select id="selectPrcsGrid" resultType="ProductionVO">
		SELECT PRCS_NO,
			   PRCS_DIV,
			   PRCS_CD,
			   PRCS_NM,
			   PRCS_CTNT
		FROM  PRCS
		WHERE PRCS_DIV=#{prcsDiv}
	</select>
	<!-- 삭제 -->
	<delete id="deletePrcsGrid" parameterType="String">
		DELETE FROM PRCS
		WHERE PRCS_CD=#{prcsCd}
	</delete>
	<!-- 등록 -->
	<insert id="insertPrcsGrid" parameterType="ProductionVO">
		INSERT INTO PRCS(PRCS_NO,
						 PRCS_DIV,
						 PRCS_CD,
						 PRCS_NM,
						 PRCS_CTNT)
				VALUES  (PRCS_SEQ.NEXTVAL,
						 #{prcsDiv},
						 #{prcsCd},
						 #{prcsNm},
						 #{prcsCtnt})
	</insert>
	<!-- 등록하고자 하는 코드 -->
	<select id="inesrtPrcsCode" resultType="ProductionVO">
		SELECT PRCS_DIV FROM PRCS WHERE PRCS_DIV=#{prcsDiv}
	</select>
	<!-- 수정 -->
	<update id="updatePrcsGrid" parameterType="ProductionVO">
		UPDATE PRCS 
					<set>
						PRCS_DIV = #{prcsDiv},
						<if test="prcsCd != null and !prcsCd.equals('')">
						PRCS_CD = #{prcsCd},
						</if>
						<if test="prcsNm != null and !prcsNm.equals('')">
						PRCS_NM = #{prcsNm},
						</if>
						<if test="prcsCtnt != null and !prcsCtnt.equals('')">
						PRCS_CTNT = #{prcsCtnt}
						</if>
					</set>
		WHERE PRCS_NO = #{prcsNo}
	</update>
	<!-- 주문서 조회 -->
	<select id="selectOrderList" resultType="ProductionVO">
		SELECT * FROM ORDER_SHEET 
		WHERE PLAN_YN = 'N'
		ORDER BY ORDER_DT
	</select>
	<!-- 주문서 디테일 조회 -->
	<select id="orderDetailGrid" resultType="ProductionVO">
		SELECT P.ORDER_NO,
	       	   R.AVAL_STC,
	       	   P.PAPRD_DT
		FROM PLAN P, RSC_STC R
		WHERE P.RSC_CD = R.RSC_CD AND P.ORDER_NO IN
	<foreach collection="array" item="test" open="(" close=")" separator="," >
		#{test}
	</foreach>
	</select>
	<!-- 생산계획 코드 부여 -->
	<update id="updatePlanCd" parameterType="ProductionVO">
		UPDATE PLAN
		SET PLAN_CD = #{planCd}
		WHERE ORDER_NO = #{orderNo}
	</update>
	<!-- 생산등록 -->
		<update id="updatePlanYn" parameterType="ProductionVO">
	 	UPDATE ORDER_SHEET
	 	SET PLAN_YN = 'Y'
	 	WHERE ORDER_NO = #{orderNo}
	</update>
</mapper>