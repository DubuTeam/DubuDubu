<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.dubu.production.mapper.ProductionMapper">

	<!-- 조회 -->
	<select id="selectPrcList" resultType="ProductionVO">
		SELECT DISTINCT(PRCS_DIV) FROM PRCS 
	</select>
	<!-- 그리드 -->
	<select id="selectPrcsGrid" resultType="ProductionVO">
		SELECT PRCS_NO,
			   PRCS_DIV,
			   PRCS_CD,
			   PRCS_NM,
			   PRCS_CTNT
		FROM  PRCS
		WHERE PRCS_DIV=#{prcsDiv}
	</select>
	<!-- 삭제 -->
	<delete id="deletePrcsGrid" parameterType="String">
		DELETE FROM PRCS
		WHERE PRCS_CD=#{prcsCd}
	</delete>
	<!-- 등록 -->
	<insert id="insertPrcsGrid" parameterType="ProductionVO">
		INSERT INTO PRCS(PRCS_NO,
						 PRCS_DIV,
						 PRCS_CD,
						 PRCS_NM,
						 PRCS_CTNT)
				VALUES  (PRCS_SEQ.NEXTVAL,
						 #{prcsDiv},
						 #{prcsCd},
						 #{prcsNm},
						 #{prcsCtnt})
	</insert>
	<!-- 등록하고자 하는 코드 -->
	<select id="inesrtPrcsCode" resultType="ProductionVO">
		SELECT PRCS_DIV FROM PRCS WHERE PRCS_DIV=#{prcsDiv}
	</select>
	<!-- 수정 -->
	<update id="updatePrcsGrid" parameterType="ProductionVO">
		UPDATE PRCS 
					<set>
						PRCS_DIV = #{prcsDiv},
						<if test="prcsCd != null and !prcsCd.equals('')">
						PRCS_CD = #{prcsCd},
						</if>
						<if test="prcsNm != null and !prcsNm.equals('')">
						PRCS_NM = #{prcsNm},
						</if>
						<if test="prcsCtnt != null and !prcsCtnt.equals('')">
						PRCS_CTNT = #{prcsCtnt}
						</if>
					</set>
		WHERE PRCS_NO = #{prcsNo}
	</update>
	<!-- 주문서 조회 -->
	<select id="selectOrderList" resultType="ProductionVO">
		SELECT * FROM ORDER_SHEET 
		WHERE PLAN_YN = 'N'
		ORDER BY ORDER_DT
	</select>
	<!-- 주문서 디테일 조회 -->
	<select id="orderDetailGrid" resultType="ProductionVO">
		SELECT ORDER_NO,
		       VEND_NM,
		       PRDT_NM,
		       ORDER_CNT
		FROM ORDER_SHEET
		WHERE ORDER_NO IN
	<foreach collection="array" item="test" open="(" close=")" separator="," >
		#{test}
	</foreach>
	</select>
	<!-- 생산계획 코드 부여 -->
	<update id="updatePlanCd" parameterType="ProductionVO">
		UPDATE PLAN
		SET PLAN_CD = #{planCd}
		WHERE ORDER_NO = #{orderNo}
	</update>
	<!-- 생산등록 -->
	<update id="updatePlanYn" parameterType="ProductionVO">
	 	UPDATE ORDER_SHEET
	 	SET PLAN_YN = 'Y'
	 	WHERE ORDER_NO = #{orderNo}
	</update>
	<!-- 생산계획 공정 조회 -->
	<select id="selectPlanEquip" resultType="ProductionVO">
		SELECT O.PRDT_NM, 
		       P.LINE_CD,
		       P.WK_TO_DT,
		       P.WK_FR_DT,
		       SUM(O.ORDER_CNT) AS ORDER_CNT,
		       P.PREF_RANK,
		       P.PLAN_CD
		FROM ORDER_SHEET O, PLAN_DTL P
		WHERE O.EDCTS_CD = P.EDCTS_CD(+)
        GROUP BY O.PRDT_NM, P.LINE_CD, P.WK_TO_DT, P.WK_FR_DT, P.PREF_RANK, P.PLAN_CD
	</select>
	<!-- 생산계획 자재 조회 -->
	<select id="selectPlanMaterial" resultType="ProductionVO">
		SELECT R.RSC_NM,
		       L.PRC_LOT_CD,
		       S.AVAL_STC,
		       H.OUST_CNT,
		       B.USE_YN
		FROM RSC R, RSC_LOT L, RSC_STC S, RSC_STC_HIST H, BOMR B, INDICA_DTL D
		WHERE R.RSC_CD = L.RSC_CD
		  AND R.RSC_CD = S.RSC_CD 
		  AND R.RSC_CD = H.RSC_CD
		  AND R.RSC_CD = B.RSC_CD
		  AND B.BOM_CD = D.BOM_CD
		  AND PLAN_CD = #{PLAN_CD}		
	</select>
</mapper>