<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.dubu.production.mapper.ProductionMapper">

	<!-- 조회 -->
	<select id="selectPrcList" resultType="ProductionVO">
		SELECT DISTINCT(PRCS_DIV) FROM PRCS 
	</select>
	<!-- 그리드 -->
	<select id="selectPrcsGrid" resultType="ProductionVO">
		SELECT PRCS_NO,
			   PRCS_DIV,
			   PRCS_CD,
			   PRCS_NM,
			   PRCS_CTNT
		FROM  PRCS
		WHERE PRCS_DIV=#{prcsDiv}
	</select>
	<!-- 삭제 -->
	<delete id="deletePrcsGrid" parameterType="String">
		DELETE FROM PRCS
		WHERE PRCS_CD=#{prcsCd}
	</delete>
	<!-- 등록 -->
	<insert id="insertPrcsGrid" parameterType="ProductionVO">
		INSERT INTO PRCS(PRCS_NO,
						 PRCS_DIV,
						 PRCS_CD,
						 PRCS_NM,
						 PRCS_CTNT)
				VALUES  (PRCS_SEQ.NEXTVAL,
						 #{prcsDiv},
						 #{prcsCd},
						 #{prcsNm},
						 #{prcsCtnt})
	</insert>
	<!-- 등록하고자 하는 코드 -->
	<select id="inesrtPrcsCode" resultType="ProductionVO">
		SELECT PRCS_DIV FROM PRCS WHERE PRCS_DIV=#{prcsDiv}
	</select>
	<!-- 수정 -->
	<update id="updatePrcsGrid" parameterType="ProductionVO">
		UPDATE PRCS 
					<set>
						PRCS_DIV = #{prcsDiv},
						<if test="prcsCd != null and !prcsCd.equals('')">
						PRCS_CD = #{prcsCd},
						</if>
						<if test="prcsNm != null and !prcsNm.equals('')">
						PRCS_NM = #{prcsNm},
						</if>
						<if test="prcsCtnt != null and !prcsCtnt.equals('')">
						PRCS_CTNT = #{prcsCtnt}
						</if>
					</set>
		WHERE PRCS_NO = #{prcsNo}
	</update>
	<!-- 주문서 조회 -->
	<select id="selectOrderList" resultType="ProductionVO">
		SELECT * FROM ORDER_SHEET 
		WHERE PLAN_YN = 'N'
		ORDER BY ORDER_DT
	</select>
	<!-- 주문서 디테일 조회 -->
	<select id="orderDetailGrid" resultType="ProductionVO">
		SELECT ORDER_NO,
		       VEND_NM,
		       PRDT_NM,
		       ORDER_CNT
		FROM ORDER_SHEET
		WHERE ORDER_NO IN
	<foreach collection="array" item="test" open="(" close=")" separator="," >
		#{test}
	</foreach>
	ORDER BY VEND_NM
	</select>
	<!-- 생산계획 코드 부여 -->
	<select id="getPlanCd" resultType="ProductionVO">
		SELECT 'PLAN_CD' || PLAN_CODE_SEQ.NEXTVAL AS PLAN_CD
		FROM DUAL
	</select>
	<!-- 생산등록 -->
	<update id="updatePlanYn" parameterType="ProductionVO">
	 	UPDATE ORDER_SHEET
	 	SET PLAN_YN = 'Y'
	 	WHERE ORDER_NO = #{orderNo}
	</update>
	<!-- 생산계획 제품 조회 -->
	<select id="selectPlanEquip" resultType="ProductionVO">
		 SELECT PRDT_NM,
               SUM(ORDER_CNT) AS ORDER_CNT
        FROM ORDER_SHEET
        WHERE ORDER_NO IN 
		<foreach collection="array" item="equip" open="(" close=")" separator="," >
		#{equip}
		</foreach>
        GROUP BY PRDT_NM
	</select>
	<!-- 생산계획 사용가능자재 조회 -->
	<select id="selectPlanMaterial" resultType="ProductionVO">
	  SELECT R.RSC_CD,
             R.RSC_NM,
	         S.AVAL_STC,
	         SUM(B.USE_CNT) AS USE_CNT
	  FROM RSC R
	 INNER JOIN RSC_STC S
	    ON R.RSC_CD = S.RSC_CD
	 INNER JOIN BOMR B
	    ON R.RSC_CD = B.RSC_CD
     INNER JOIN ORDER_SHEET O
        ON R.VEND_CD = O.VEND_CD
     WHERE O.ORDER_NO IN
		<foreach collection="array" item="material" open="(" close=")" separator="," >
		#{material}
		</foreach>
	GROUP BY R.RSC_CD, R.RSC_NM, S.AVAL_STC
	</select>
	<!-- 생산계획 제품공정확인 -->
	<select id="planEquipCheck" resultType="ProductionVO">
	    <!-- SELECT I.EDCTS_CD,
	           I.LINE_CD,
	           P.PRCS_CD,
	           I.PLAN_CD
	    FROM INDICA_DTL I
	INNER JOIN PRCS_PROG P
	        ON I.INDICA_DT = P.INDICA_DT
	WHERE I.PLAN_CD = #{planCd} -->
	</select>
<!-- 	 생산계획 자재확인 
	<select id="planMaterialCheck" resultType="ProductionVO">
		SELECT B.RSC_CD,
	           B.PRCS_CD,
	           R.OUST_CNT,
	           P.PLAN_CD
	    FROM BOMR B
	    INNER JOIN RSC_OUST R
	    ON B.RSC_CD = R.RSC_CD
	    INNER JOIN PRCS_PROG P
	    ON B.PRCS_CD = P.PRCS_CD
        INNER JOIN RSC_LOT L
        ON B.RSC_CD = L.RSC_CD
	    WHERE L.PRC_LOT_CD = #{prcLotCd}
	</select -->
</mapper>