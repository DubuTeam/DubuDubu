<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.yedam.dubu.equipment.mapper.EquipmentMapper">

	<!-- 라인 관리 - 전체 조회 -->
	<select id="selectAllEquipmentLineList" resultType="EquipmentVO">
		SELECT * FROM EQM_LINE ORDER BY line_cd
	</select>
	
	<!-- 부여될 라인 코드를 미리 조회 (등록과 관련)  -  라인명은 LINE0002, LINE0003  이런식으로 문자열이다. -->
	<select id="getLineCode" resultType="String">
		SELECT NVL2(MAX(line_cd), 'LINE'||LPAD(REPLACE(MAX(line_cd), 'LINE') + 1, 4, '0'), 'LINE0001') FROM eqm_line
	</select>
	
	
	<!-- 추가 -->
	<insert id="insertEquipmentLine" parameterType="equipmentVO">
		INSERT INTO eqm_line
						(
							line_cd,
							line_nm,
							eqm_psch,
							uph_cnt,
							use_yn
						)
				VALUES (
							#{lineCd},
							#{lineNm},
							#{eqmPsch},
							#{uphCnt},
							#{useYn}
						)			
	</insert>
	

	<!-- 수정 -->
	<update id="updateEquipmentLine" parameterType="equipmentVO">
		UPDATE eqm_line
		SET
			line_nm = #{lineNm},
			eqm_psch = #{eqmPsch},
			uph_cnt = #{uphCnt},
			use_yn = #{useYn}
		WHERE line_cd = #{lineCd}
	</update>
	
	
	<!-- 삭제 -->
	<delete id="deleteEquipmentLine" parameterType="equipmentVO">
		DELETE FROM eqm_line
			WHERE line_cd = #{lineCd}
	</delete>
	
	
	
	<!-- ↓↓↓ 설비 관리 페이지 -->
	
	
	<!-- 공정 관리 테이블 조회 -->
	<select id="selectAllProcessList" resultType="EquipmentVO">
		SELECT * FROM PRCS ORDER BY prcs_cd
	</select>
	
	<!-- 공통 코드 테이블 조회 -->
	<select id="selectAllCommonDataList" resultType="EquipmentVO">
		<!-- 공통코드 중 E로 시작하는 코드만 조회 (그게 설비구분 공통코드임) -->
		SELECT * FROM ccds WHERE UPPER(ccd) LIKE 'E%' ORDER BY ccd
	</select>
	

	<!-- 설비 목록 출력 -->
	<select id="selectAllEquipmentList" resultType="EquipmentVO">
		SELECT
			ROWNUM AS "idx",
			eqm_nm,
			eqm_cd,
			prcs_cd,
			prcs_nm,
			eqm_yn,
			min_temp,
			max_temp,
			chck_perd,
			line_cd,
			eqm_ist_dt
		FROM eqm
		ORDER BY eqm_cd
	</select>
	
	<!-- 설비 등록하기 -->
	<!-- 설비구분은 일부러 안 넣음 (어차피 안 쓴다) -->
	<insert id="insertEquipment" parameterType="equipmentVO">
		INSERT INTO EQM 
		                (
		                 eqm_cd,
		                 line_cd,
		                 prcs_cd,
		                 prcs_nm,
		                 eqm_nm,
		                 eqm_yn,
		                 chck_perd,
		                 min_temp,
		                 max_temp,
		                 eqm_ist_dt
		                )
		        VALUES (
		        		#{eqmCd},
		                #{lineCd},
		                #{prcsCd},
		                #{prcsNm},
		                #{eqmNm},
		                #{eqmYn},
		                #{chckPerd},
		                #{minTemp},
		                #{maxTemp},
		                #{eqmIstDt}
		                )
	</insert>
	
	<!-- 설비 수정하기 -->
	<update id="updateEquipment" parameterType="equipmentVO">
		UPDATE eqm
		SET
			eqm_nm = #{eqmNm},
            line_cd = #{lineCd},
            prcs_cd = #{prcsCd},
            prcs_nm = #{prcsNm},
            eqm_yn = #{eqmYn},
            chck_perd = #{chckPerd},
            min_temp = #{minTemp},
            max_temp = #{maxTemp},
            eqm_ist_dt = #{eqmIstDt}
		WHERE eqm_cd = #{eqmCd}
	</update>
	
	<!-- 설비 삭제하기 -->
	<delete id="deleteEquipment" parameterType="String">
		DELETE FROM eqm WHERE eqm_cd = #{eqmCd}
	</delete>
	
	<!-- 설비 검색하기 -->
	<select id="selectSpecificEquipmentList" resultType="EquipmentVO">
		SELECT *
		FROM eqm
		WHERE eqm_cd = #{keyword}
<!-- 		WHERE type = #{type}
		<if test="search != ' '">
		AND 컬럼 LIKE '%' || #{keyword} || '%'
		</if> -->
	</select>
</mapper>
